# ESXI 6.7 templates generated by Packer

## Prepare ESXI Host

##### https://nickcharlton.net/posts/using-packer-esxi-6.html

Connect to ssh

```shell
$ esxcli system settings advanced set -o /Net/GuestIPHack -i 1
$ chmod 644 /etc/vmware/firewall/service.xml
$ chmod +t /etc/vmware/firewall/service.xml
$ vi /etc/vmware/firewall/service.xml
```

```xml
<service id="1000">
  <id>packer-vnc</id>
  <rule id="0000">
    <direction>inbound</direction>
    <protocol>tcp</protocol>
    <porttype>dst</porttype>
    <port>
      <begin>5900</begin>
      <end>6000</end>
    </port>
  </rule>
  <enabled>true</enabled>
  <required>true</required>
</service>
```

```shell
$ chmod 444 /etc/vmware/firewall/service.xml
$ esxcli network firewall refresh
```
### Before begin prepare .env file
```shell
export VCENTER_HOST={{hostname}}
export VCENTER_USERNAME={{user}}
export VCENTER_PASSWORD={{pass}}
export VCENTER_DATASTORE={datastore}
export VCENTER_NETWORK={{network}}
```
### Add env variables:

```shell
$ source example.env
```

### Install packer
```shell
$ brew install packer
```
### Generate passwords for kickstart file
```shell
$ python -c 'import getpass; import passlib.hash; h=passlib.hash.sha512_crypt.hash(getpass.getpass()); print(h if (passlib.hash.sha512_crypt.verify(getpass.getpass("Confirm:"), h)) else "")'
```

### Make templates for Centos 7
```shell
$ make build-c7
```

### Make templates for Centos 8
```shell
$ make build-c8
```


## Debian links

https://www.debian.org/releases/jessie/debian-installer/
https://wiki.debian.org/DebianInstaller/Preseed
https://www.debian.org/releases/stable/example-preseed.txt

https://serverfault.com/questions/1077958/preseeding-debian-11-fully-unattended-get-rid-of-questions

https://cdimage.debian.org/cdimage/archive/8.11.1/amd64/iso-cd/

## Packer Links
https://github.com/korekontrol/packer-debian8
https://gitlab.inria.fr/lnussbau/debian-vm-templates/-/tree/86a6a58aa97347b5d4de300e8fb061454ca2de4e/packer-virtualbox-vagrant
https://github.com/eloycoto/packer-debian-8-jessie-template

https://github.com/vmware-samples/packer-examples-for-vsphere